# JPA 활용1
#TIL/JPA 활용1/

---
## 도메인 분석 설계

![](./images/J활_1.PNG)

기능 목록
- 회원 기능
    - 회원 등록
    - 회원 조회
- 상품 기능
    - 상품 등록
    - 상품 수정
    - 상품 조회
- 주문 기능
    - 상품 주문
    - 주문 내역 조회
    - 주문 취소

예제를 단순화 하기 위해 다음 기능은 구현X
- 로그인과 권한 관리X
- 파라미터 검증과 예외 처리X
- 상품은 도서만 사용
- 카테고리는 사용X
- 배송 정보는 사용X

## 엔티티 설계시 주의점

- 엔티티에는 가급적 Setter를 사용 X

- 모든 연관관계는 지연로딩으로 설정
    - 연관된 엔티티를 함께 DB에서 조회해야 하면, fetch join 또는 엔티티 그래프 기능을 사용

- 컬렉션은 필드에서 초기화 하자
    - null 문제에서 안전


기술 설명

- @PersistenceContext: 엔티티 매니저 주입
- @PersistenceUnit: 엔티티 매니저 팩토리 주입
- @Transactional: 트랜잭션, 영속성 컨텍스트
    - readOnly = true: 데이터의 변경이 없는 읽기 전용 메서드에 적용, 영속성 컨텍스트를 플러시 하지 않으므로 약간의 성능 향상
- @Runwith(SpringRunner.class): 스프링과 테스트 통합
- @SpringBootTest: 스프링 부트 띄우고 테스트



참고: 
- 엔티티가 비즈니스 로직을 가지고 객체 지향의 특성을 적극 활용하는 것을 도메인 모델 패턴
- 엔티티에는 비즈니스 로직이 거의 없고 서비스 계층에서 대부분의 비지니스 로직을 처리하는 것을 트랜잭션 스크립트 패턴


# 2022.12.19
#etc/2022.12.19
---

```
Type 1
하드웨어 기반 가상화
- 네이티브 방식, 혹은 베어메탈(bare-meatal) 방식
하이퍼바이져가 직접 하드웨어를 제어
- 메모리 사용량이 적고 가상화로 인한 부하가 적다
- 게스트 운영체제는 하드웨어에 설치된 하이퍼바이져에서 두번째 수준으로 실행
- 호스트 OS가 없는 경우 일반적으로 type 1으로 분류
- 호스트 OS가 있더라도 하이퍼바이져가 직접 하드웨어를 제어할 수 있으면 type
1으로 분류

Type 2
운영체제 기반 가상화
- 호스티드(hosted) 방식
- 하드웨어 위에 운영체제가 구동하고, 그 체제 위에 하이퍼바이저가 존재
- 게스트 운영체제는 하드웨어에서 세번째 수준으로 실행
  - Host OS - Hypervisor - Guest OS
- 모든 요청은 호스트 운영체제를 통하여 하드웨어 접근
  - 즉, 하이퍼바이져가 직접 하드웨어를 제어하지 못함
- 호환성이 높지만 오버헤드로 인해 성능이 상대적으로 감소

전 가상화 (Full-virtualization)
- 하드웨어를 모두 가상화 한 것
- 가상화 SW가 모든 기능 수행
- Guest OS 수정 필요 없음
- CPU의 가상화 기술을 이용해야 함

반 가상화 (Para-virtualization)
- 가상화 소프트웨어와 Guest OS가 의존 관계를 가짐
- Guest OS가 하드웨어를 직접 제어하지 못하고 Hypervisor를 통해서만 가능
- Hypervisor는 하드웨어 제어권을 모두 가짐
  - hypervisor가 필요에 따라 Guest OS를 조정

서버 가상화
- 다중 접근 제어 및 이용률 향상

스토리지 가상화
- 여러 개의 물리적 저장 공간을 하나의 논리적 공간으로 통합

네트워크 가상화
- 네트워크를 독립된 사설 VPN으로 파티션

내장형 시스템 가상화
- 다양한 내장형 장치를 가상화 시켜 표준 인터페이스로 접근토록 함

CPU 가상화
직접 수행 기술(Direct Execution)
- 가상 머신을 실제 머신 상에서 직접 수행
- 동시에 CPU에 대한 제어는 전적으로 VMM이 담당

스케쥴링
- 각 가상머신의 크레딧에 비례하여 물리 CPU 할당 

Memory 가상화 이슈
물리 메모리를 가상 메모리로 추상화시켜 지원
메모리 동적 회수와 할당
공유를 통한 메모리 공간 절약기법

메모리 동적 회수와 할당
- 벌룬 프로세서 (Ballon Process)
- Guest OS 에서 동작하는 일종의 데몬 시스템 프로세스
- 팽창과 수축을 반복

- 벌룬 팽창
  – 각 Pi의 페이지를 벌룬에 할당함
- 벌룬 수축
  – 페이지를 실제 각 응용 프로그램들에 할당

가상 머신 이주
- 동일한 가상 자원을 사용하는 호스트라면 이주에 자유로워야 함

고려 사항
- 다운 타임
- 이주 비용

대표적 이주 기법
- 중단 복사: 가상 머신을 중단 시킨 후, 복사 이주 실행
- 라이브 이주
  - 선 복사(Pre-Copy)
    - 호스트A에서 B로 복사 수행, 기존 호스트A는 계속 서비스
    - 더티 페이지 가능
  - 후 복사(Post-Copy)
    - 호스트 A에서, B로 일부만 복사한 후, 신규 호스트 B는 수행 시작. 즉, 신규 서비스가 우선 수행되고 이후에 복사가 진행도 ㅣㅁ
    - 네트워크 폴트 발생(존재하지 않는 문맥 수행 시)

하이퍼 바이저
- 모든 컴퓨팅 자원을 가상자원으로 추상화하고 가상자원으로 가상머신 생성
-  일반적으로 하나의 물리서버에 제한되어 동작
컨테이너
- 운영체제 수준에서 제공, 특정 응용을 위한 독립된 공간 제공

가상 인프라스트럭쳐 관리 (VIM, Virtual Infrstructure Monitor)
- 다중 물리 서버와 가상 서버들을 유연하게 통합 및 동작하도록 지원

VMM vs VIM
VMM (하이퍼바이져)
- 하나의 물리적 서버에 존재하는 물리 자원을 자신이 생성한 가상머신에게 제공
VIM
- 다중 물리 서버에 대한 다중 하이퍼바이져 관리 기능 제공

컨테이너(container)란?
- 기본 운영체제를 공유하며, 운영체제 안에서 다른 프로세스 그룹과 격리되어 실행되는 프로세스 그룹

가상 서버
- 하이퍼바이져에 의해 생성된 관리 대상
- 물리 서버를 에뮬레이트(emulate)하는 가상화 소프트웨어의 형태

자동 확장 기술 (Auto-Scaling)
- 자동으로 작업 부하 상태 정보 추적
- 자동으로 IT 자원을 확장하거나 축소하는 역활

부하 균등 기술
- 성능 향상 뿐만 아니라, 응답 시간 단축 및 가용성도 증가

부하 분산 알고리즘
- 라운드 로빈(Round-Robin)
  - 복제본이 3개라면, A-B-C 순서로 접근 반복
- 가중 라운드 로빈 (Weighted RR)
  - 수용량(계산 능력)이 더 큰 단을 우선적으로 선택
- 최소 부하 라운드 로빈
  - 관리자는 최소 부하 노드 우선 선택

네트워크 계층별 부하 분산
- L3 부하 분산기
  - IP 주소에 기초하여 부하 분산 실행
- L4 부하 분산기
  - IP 주소와 함께 원본과 대상 Port 정보를 활용하여 부하 분산
- L7 부하 분산기
  - 응용 계층엥서 파악한 정보를 바탕으로 부하 분산 수행
```